---
title: "Analysis"
output: html_document
---

```{r}
  # load necessary libraries
  library(stringr)

  # The url for the NOAA Juneau airport weather data CSV file
  csv_url <- "https://www.ncei.noaa.gov/access/past-weather/USW00025309/data.csv"
  
  # import the Juneau dataset
  Juneau <- read.csv(csv_url, skip = 1)
  head(Juneau)

  # subset data to just 2023 by filtering the data column to strings with just "2023" as the first four characters
  data_2023 <- Juneau[substr(Juneau$Date, 1, 4) == "2023", ]
  head(data_2023)
  
  hist(data_2023$TAVG..Degrees.Fahrenheit., 
       main = "Histogram of Average Temperatures in Juneau (2023)", 
       xlab = "Average Temperature (°F)", 
       ylab = "Frequency", 
       col = "blue", 
       border = "black")
  
  # histogram of average temp by month in 2023
  data_2023$Month <- as.numeric(substr(data_2023$Date, 6, 7))
  par(mfrow = c(3, 4)) # set up a 3
  for (month in 1:12) {
    hist(data_2023$TAVG..Degrees.Fahrenheit.[data_2023$Month == month], 
         main = paste("Histogram of Avg Temp - Month", month, "(2023)"), 
         xlab = "Average Temperature (°F)", 
         ylab = "Frequency", 
         col = "lightblue", 
         border = "black")
  }
  
  # Investigation of average temp by seasons for 2023
  season_data <- data_2023
  fall_months <- c(9, 10, 11)
  winter_months <- c(12, 1, 2)
  spring_months <- c(3, 4, 5)
  summer_months <- c(6, 7, 8)
  par(mfrow = c(1, 2)) # set up a 1x2 layout
  # fall
  hist(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% fall_months], 
       main = "Histogram of Avg Temp - Fall Months, 2023",
       xlab = "Average Temperature (°F)",
       ylab = "Frequency",
       col = "brown",
       border = "black")
  sd(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% fall_months], na.rm = TRUE)
  # winter
  hist(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% winter_months], 
       main = "Histogram of Avg Temp - Winter Months, 2023",
       xlab = "Average Temperature (°F)",
       ylab = "Frequency",
         col = "lightgray",
       border = "black")
  sd(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% winter_months], na.rm = TRUE)
  # spring
  hist(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% spring_months],
       main = "Histogram of Avg Temp - Spring Months, 2023",
       xlab = "Average Temperature (°F)",
       ylab = "Frequency",
       col = "lightgreen",
       border = "black")
  sd(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% spring_months], na.rm = TRUE)
  # summer
  hist(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% summer_months], 
       main = "Histogram of Avg Temp - Summer Months, 2023",
       xlab = "Average Temperature (°F)",
       ylab = "Frequency",
       col = "orange",
       border = "black")
  sd(season_data$TAVG..Degrees.Fahrenheit.[data_2023$Month %in% summer_months], na.rm = TRUE)
  
  # run a levene test between seasons to see if variances are equal
  library(car)
  season_data$Season <- NA
  season_data$Season[season_data$Month %in% fall_months] <- "Fall"
  season_data$Season[season_data$Month %in% winter_months] <- "Winter"
  season_data$Season[season_data$Month %in% spring_months] <- "Spring"
  season_data$Season[season_data$Month %in% summer_months] <- "Summer"
  
  # Levene's Test between Fall and sping
  leveneTest(TAVG..Degrees.Fahrenheit. ~ Season, data = season_data[ season_data$Season %in% c("Fall", "Spring"), ])
  # Levene's Test between Winter and Summer
  leveneTest(TAVG..Degrees.Fahrenheit. ~ Season, data = season_data[ season_data$Season %in% c("Winter", "Summer"), ])
  # Levene's Test between Fall and Winter
  leveneTest(TAVG..Degrees.Fahrenheit. ~ Season, data = season_data[ season_data$Season %in% c("Fall", "Winter"), ])
  # spirng and summer 
  leveneTest(TAVG..Degrees.Fahrenheit. ~ Season, data = season_data[ season_data$Season %in% c("Spring", "Summer"), ])
  # summer and fall
  leveneTest(TAVG..Degrees.Fahrenheit. ~ Season, data = season_data[ season_data$Season %in% c("Summer", "Fall"), ])
  
  
  
  # histogram of average temp by year for years 2010 to 2023
  Juneau$Year <- as.numeric(substr(Juneau$Date, 1, 4))
  par(mfrow = c(6, 4)) # set up a 6
  for (year in 2014:2023) {
    # graph and make sure the x axis is consistent across all histograms
    hist(Juneau$TAVG..Degrees.Fahrenheit.[Juneau$Year == year], 
         main = paste("Histogram of Avg Temp - Year", year), 
         xlab = "Average Temperature (°F)", 
         ylab = "Frequency", 
         col = "lightgreen", 
         border = "black", 
         xlim = c(min(Juneau$TAVG..Degrees.Fahrenheit., na.rm = TRUE), max(Juneau$TAVG..Degrees.Fahrenheit., na.rm = TRUE)))
  }
  
```

```{r}
# investigate the relationship between TAVG and Percipitation,Snow, and SnowDepth
  Tavg <- data_2023$TAVG..Degrees.Fahrenheit.
  percipitation <- data_2023$PRCP..Inches.
  Snow <- data_2023$SNOW..Inches.
  SnowDepth <- data_2023$SNWD..Inches.
  
  plot(percipitation, Tavg, 
       main = "Average Temperature vs. Precipitation (2023)", 
       xlab = "Precipitation (inches)", 
       ylab = "Average Temperature (°F)", 
       col = "red", 
       pch = 19)
  plot(Snow, Tavg,
       main = "Average Temperature vs. Snow (2023)", 
       xlab = "Precipitation (inches)", 
       ylab = "Average Temperature (°F)", 
       col = "red", 
       pch = 19)
  plot(SnowDepth, Tavg,
       main = "Average Temperature vs. Snow Depth (2023)",
       xlab = "Snow Depth (inches)",
       ylab = "Average Temperature (°F)",
       col = "red",
       pch = 19)
```
```{r}
  # bin the TAVG by 10 degree increments
  bins <- cut(Tavg, breaks = seq(floor(min(Tavg, na.rm = TRUE)/10)*10, ceiling(max(Tavg, na.rm = TRUE)/10)*10, by = 10), include.lowest = TRUE)
  binned_data <- data.frame(Tavg = Tavg, Percipitation = percipitation, Snow = Snow, SnowDepth = SnowDepth, Bin = bins)
  
  # remove rows with zero percip, snow, or snowdepth to avoid skewing the analysis.
  binned_data <- binned_data[binned_data$Percipitation > 0 & binned_data$Snow > 0 & binned_data$SnowDepth > 0, ]
  
  # plot new tavg vs percipitation, snow, and snowdepth
  plot(binned_data$Percipitation, binned_data$Tavg,
       main = "Binned Average Temperature vs. Precipitation (2023)", 
       xlab = "Precipitation (inches)", 
       ylab = "Average Temperature (°F)", 
       col = "green", 
       pch = 19)
  plot(binned_data$Snow, binned_data$Tavg,
       main = "Binned Average Temperature vs. Snow (2023)",
       xlab = "Snow (inches)",
       ylab = "Average Temperature (°F)",
       col = "green",
       pch = 19)
  plot(binned_data$SnowDepth, binned_data$Tavg,
       main = "Binned Average Temperature vs. Snow Depth (2023)",
       xlab = "Snow Depth (inches)",
       ylab = "Average Temperature (°F)",
       col = "green",
       pch = 19)

  mod <- lm(Percipitation ~ Bin, data = binned_data)
  # residuals plot
  plot(mod$residuals, 
       main = "Residuals of Percipitation Model", 
       ylab = "Residuals", 
       xlab = "Index", 
       col = "purple", 
       pch = 19)
  summary(mod)
  
  mod2 <- lm(Snow ~ Bin, data = binned_data)
  # residuals plot
  plot(mod2$residuals, 
       main = "Residuals of Percipitation Model", 
       ylab = "Residuals", 
       xlab = "Index", 
       col = "purple", 
       pch = 19)
  summary(mod2)
  
  mod3 <- lm(SnowDepth ~ Bin, data = binned_data)
  # residuals plot
  plot(mod3$residuals, 
       main = "Residuals of Percipitation Model", 
       ylab = "Residuals", 
       xlab = "Index", 
       col = "purple", 
       pch = 19)
  summary(mod3)

```
  
  
  
  
  
  
  